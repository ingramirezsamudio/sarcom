<!DOCTYPE html>
<html lang="es">
<head>

	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/png" sizes="16x16" href="dist/images/favicon.png">
    <title>Ver Datos - SARCOM</title>
	<style type="text/css">
		:root {
			--blue: #009efb;
			--indigo: #6610f2;
			--purple: #7460ee;
			--pink: #e83e8c;
			--red: #f62d51;
			--orange: #fb9678;
			--yellow: #ffbc34;
			--green: #36bea6;
			--teal: #20c997;
			--cyan: #01c0c8;
			--white: #fff;
			--gray: #6c757d;
			--gray-dark: #343a40;
			--blue: #009efb;
			--indigo: #6610f2;
			--purple: #7460ee;
			--pink: #e83e8c;
			--red: #f62d51;
			--orange: #fb9678;
			--yellow: #ffbc34;
			--green: #36bea6;
			--teal: #20c997;
			--cyan: #01c0c8;
			--white: #fff;
			--gray: #6c757d;
			--secondary: #f8f9fa;
			--success: #006666;
			--success_hover: #004040;
			--info: #00732d;
			--warning: #d16901;
			--warning_hover: #a35201;
			--default: #949494;
			--default_hover: #7e7e7e;
			--danger: #c72344;
			--light: #f8f9fa;
			--dark: #343a40;
			--cyan: #01c0c8;
			--purple: #7460ee;
			--primary: #102a83;
			--primary_hover: #00732d;
			--focus: 0 0 0 2px rgba(84,38,147,0.3);
			--breakpoint-xs: 0;
			--breakpoint-sm: 576px;
			--breakpoint-md: 768px;
			--breakpoint-lg: 992px;
			--breakpoint-xl: 1600px;
			--font-family-sans-serif: 'Rubik', sans-serif;
			--font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
		}
	</style>
	<script src="dist/js/jquery/jquery-3.2.1.min.js"></script>
	<!-- Bootstrap popper Core JavaScript -->
	<script src="dist/js/popper/popper.min.js"></script>
    <script src="dist/js/bootstrap/js/bootstrap.min.js"></script>
    <script src="dist/js/perfect-scrollbar.jquery.min.js"></script>
    <!--Wave Effects -->
    <script src="dist/js/waves.js"></script>
    <!--Menu sidebar -->
    <script id="script" src="dist/js/sidebarmenu.js?v=2"></script>
	<script src="dist/js/jquery.easing.min.js"></script>
	<script src="dist/js/jquery-ui/jquery-ui.min.js"></script>
    <!-- Sweet-Alert  -->
	<link href="dist/js/sweetalert/sweetalert.css" rel="stylesheet" type="text/css">
    <script src="dist/js/sweetalert/sweetalert.min.js"></script>
	<!-- TOAST -->
	<link href="dist/js/toast-master/css/jquery.toast.css" rel="stylesheet">
	<script src="dist/js/toast-master/js/jquery.toast.js"></script>
	<!-- Nprogress -->
	<script src="dist/js/nprogress/nprogress.js"></script>
	<link href="dist/js/nprogress/nprogress.css?v=1" rel="stylesheet">
	<!-- Select2 -->
	<link href="dist/js/select2/css/select2.min.css" rel="stylesheet">
	<link href="dist/js/select2/css/select2-bootstrap4.min.css" rel="stylesheet">
	<script src="dist/js/select2/js/select2.full.min.js"></script>
	<script src="dist/js/select2/js/select2-dropdownPosition.js"></script>
	<script src="dist/js/select2/js/i18n/es.js"></script>
	<!-- Custom -->
	<link href="dist/css/style.css?v=2" rel="stylesheet">
	<link href="dist/css/custom.css?v=6" rel="stylesheet">
	<script src="dist/js/custom.js?v=1"></script>
	<!-- fin header.php -->
<link rel="stylesheet" href="dist/js/bootstrap-table/bootstrap-table.css">
<script src="dist/js/bootstrap-table/bootstrap-table.js"></script>
<script src="dist/js/bootstrap-table/extensions/export/bootstrap-table-export.js"></script>
<script src="dist/js/bootstrap-table/extensions/export/tableExport.js"></script>
<script src="dist/js/bootstrap-table/locale/bootstrap-table-es-CL.min.js"></script>
<!-- <script type="text/javascript" src="dist/js/jsignature/flashcanvas.js"></script> -->
<script src="dist/js/jsignature/jSignature.min.js"></script>
<script src="dist/js/jsignature/jSignature.min.noconflict.js"></script>
<script src="dist/js/jsignature/flashcanvas.js"></script>
<!-- <script src="dist/js/jsignature/flashcanvas.swf"></script> -->


<!-- Typehead -->
<script type="text/javascript" src="dist/js/typeahead/typeahead.bundle.min.js"></script>
<script type="text/javascript" src="dist/js/typeahead/handlebars.min.js"></script>
<link href="dist/js/typeahead/typeahead.css" rel="stylesheet">

</head>

<body class="skin-default-dark lock-nav fixed-layout">
    <div class="preloader">
        <div class="loader">
            <div class="loader__figure"></div>
            <p class="loader__label">Cargando Ñamandú...</p>
        </div>
    </div>
    <div id="main-wrapper">
		<!-- topbar.php -->
		<header class="topbar">
			<nav class="navbar top-navbar navbar-expand-md navbar-dark">

				<div class="navbar-collapse">

					<ul class="navbar-nav mr-auto">
						<!-- This is  -->
						<li class="nav-item hidden-sm-up"> <a class="nav-link nav-toggler waves-effect waves-light" href="javascript:void(0)"><i class="fas fa-bars"></i></a></li>

						<li class="nav-item">
							<span class="titulo">Ver Datos</span>

						</li>
					</ul>
					<ul class="navbar-nav my-lg-0">
						<!-- ============================================================== -->
						<!-- User profile and search -->
						<!-- ============================================================== -->
						<!--<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle text-muted waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="dist/images/users/1.jpg" alt="user" class="img-circle" width="30"></a>
						</li>-->

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle text-muted waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="dist/images/users/nobody.png" alt="user" class="img-circle" width="30"></a>
							<div class="dropdown-menu dropdown-menu-right user-dd animated flipInY">
								<span class="with-arrow"><span class="bg-primary"></span></span>
								<div class="d-flex no-block align-items-center p-15 bg-primary text-white m-b-10">
									<div class=""><img src="dist/images/users/nobody.png" alt="user" class="img-circle" width="60"></div>
									<div class="m-l-10">
										<h4 id="nombre_usuario" class="m-b-0">Usuario</h4>
									</div>
								</div>
								<button class="dropdown-item" href="" onclick="logout()"><i class="fa fa-power-off m-r-5 m-l-5"></i> Cerrar Sesión</button>
								<!--<div class="dropdown-divider"></div>
								<div class="p-l-30 p-10"><a href="javascript:void(0)" class="btn btn-sm btn-success btn-rounded">View Profile</a></div>-->
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- User profile and search -->
						<!-- ============================================================== -->
					</ul>
				</div>
			</nav>
		</header>
		<!-- fin topbar.php -->
		<!-- leftbar.php -->
		<aside class="left-sidebar">
			<div class="d-flex no-block nav-text-box align-items-center">
				<span><img src="dist\images\logo-icon.png" alt="SARCOM"></span>
				<a class="nav-lock waves-effect waves-dark ml-auto hidden-md-down" href="javascript:void(0)"><i class="mdi mdi-toggle-switch"></i></a>
				<a class="nav-toggler waves-effect waves-dark ml-auto hidden-sm-up" href="javascript:void(0)"><i class="ti-menu ti-close"></i></a>
			</div>
			<!-- Sidebar scroll-->
			<div class="scroll-sidebar">
				<!-- Sidebar navigation-->
				<nav class="sidebar-nav">
					<ul id="sidebarnav">
					<!-- se carga en el onload con ajax -->
					</ul>
				</nav>
			<!-- End Sidebar navigation -->
			</div>
		<!-- End Sidebar scroll-->
		</aside>
		<!-- fin leftbar.php -->
        <div class="page-wrapper">
            <div class="container-fluid mt-3">



									<div class="form-group text-center">

										<form id="formulario" class="text-center" enctype="multipart/form-data">

										<div id="carrusel" class="carousel slide">
											<div class="carousel-inner">
												<div class="carousel-item active">

													<div class="col-md-12 col-sm-12">
														<h3><b>Información de Pedido</b></h3>
														<hr>
													</div>

													<div class="row mt-3">
														<input type="hidden" id="hidden_id_pedido" name="hidden_id_pedido">


													<div class="col-md-6 col-sm-12">
														<h4 class=""><b>Nombre y Apellido :</b></h4><h5 id="nombre_apellido"></h5>
													</div>
													<div class="col-md-6 col-sm-12">
														<h4 class=""><b>CI/RUC :</b></h4><h5 id="ruc"></h5>
													</div>
													<div class="col-md-12 col-sm-12">
														<h4 class=""><b>Direccion :</b></h4><h5 id="direccion"></h5>
													</div>
													<div class="col-md-12 col-sm-12">
														<h4 class=""><b>Nro. de Casa :</b></h4><h5 id="nro_casa"></h5>
													</div>
													<div class="col-md-6 col-sm-12">
														<h4 class=""><b>Zona :</b></h4><h5 id="zona"></h5>
													</div>
													<div class="col-md-6 col-sm-6">
														<h4 class=""><b>Correo Electrónico :</b></h4><h5 id="correo"></h5>
													</div>
													<div class="col-md-6 col-sm-6">
														<h4 class=""><b>Entidad :</b></h4><h5 id="entidad"></h5>
													</div>

													<div class="col-md-12 col-sm-12">
														<hr>
														<div class="row">
															<div class="col-md-12 col-sm-12">
																<button class="btn btn-danger btn-lg mt-3" type="button" id="btn_no_entrega">No entregado</button>
																<button class="btn btn-primary btn-lg mt-3 carrusel-next" type="button">Registrar Entrega</button>
															</div>
														</div>
													</div>
													</div>
												</div>

												<!-- foto -->
												<div class="carousel-item">
													<div class="col-md-12 col-sm-12">
														<h3><b>Registar entrega</b></h3>
														<hr>
													</div>
													<div class="col-md-12 col-sm-12">
														<h3>Añadir foto</h3>
														<div class="text-center mt-2">
															<!-- <img style="height:300px" id="prev_foto_cedula" class="img-thumbnail" src=""> -->
															<img style="height:200px;" id="prev_foto_cedula0" class="img-thumbnail" src="">
															<img style="height:200px;" id="prev_foto_cedula1" class="img-thumbnail" src="">
															<img style="height:200px;" id="prev_foto_cedula2" class="img-thumbnail" src="">
															<img style="height:200px;" id="prev_foto_cedula3" class="img-thumbnail" src="">
															<img style="height:200px;" id="prev_foto_cedula4" class="img-thumbnail" src="">
														</div>
														<label for="foto_cedula" class="btn btn-primary btn-lg mt-3"><i class="fas fa-camera"></i></label>
														<hr class="mt-2">
													</div>
													<div class="col-md-12 col-sm-12">
														<!-- <input style="display:none" type="file" name="foto_cedula" id="foto_cedula" class="" accept="image/*" capture="camera" /> -->
														<input style="display:none" type="file" name="foto_cedula[]" id="foto_cedula" class=""  capture="camera" multiple >

														<button class="btn btn-secondary btn-lg mt-3 carrusel-prev" type="button">Atras</button>
														<button id="btn_foto" disabled class="btn btn-primary btn-lg mt-3 carrusel-next" type="button" name="button" >Siguiente</button>
														<button id="btn_foto_omitir" class="btn btn-primary btn-lg mt-3 carrusel-next" type="button" name="button" >Omitir</button>
													</div>
												</div>

												<!-- pin -->
											<!--	<div class="carousel-item pin">
													<div class="col-md-12 col-sm-12">
														<h3><b>Ingresar PIN</b></h3>
														<hr>
													</div>
													<div style="margin:auto" class="col-md-6 col-sm-12 mt-2">
														<input class="form-control input-sm" type="password" name="pin" id="pin" autocomplete="off">
													</div>
													<hr class="mt-2">
													<div class="col-md-12 col-sm-12">
														<button class="btn btn-secondary btn-lg mt-3 carrusel-prev" type="button">Atras</button>
														<button id="verificar_pin" disabled class="btn btn-primary btn-lg mt-3" type="button">Siguiente</i></button>
													</div>
												</div>-->


												<!-- firma -->
												<div class="carousel-item">
													<div class="col-md-12 col-sm-12">
														<h3><b>Añadir Firma</b></h3>
														<hr>
													</div>
													<div class="col-md-12 col-sm-12">
														<div class="text-center mt-2">
															<img style="width:100%" id="prev_firma" class="img-thumbnail" src="">
														</div>
														<button class="btn btn-primary btn-lg mt-2" type="button" id="btn_modal_firma"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Firmar</button>
														<hr class="mt-2">
													</div>
													<!-- <div class="text-center mt-5">
													</div> -->
													<!-- <hr class="mt-5"> -->
													<div class="col-md-12 col-sm-12">
														<button class="btn btn-secondary btn-lg mt-3 carrusel-prev" type="button">Atras</button>
														<button disabled class="btn btn-primary btn-lg mt-3" type="submit" id="guardar">Registrar Entrega</button>
													</div>
												</div>


											<div>

										<div>

										<input type="hidden" id="q" name="q" value="registrar_entrega">
										<input type="hidden" id="firma" name="firma">
										<input type="hidden" id="id_pedido" name="id_pedido" value="">

										</form>


										<!-- MODAL FIRMA -->
										<div class="modal fade" id="modal_firma" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
											<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="modalLabel_codigo_qr">FIRMA</h5>
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
													</div>
													<div class="modal-body">
														<div>
															<div id="signature"></div>
														</div>
													</div>
													<div class="modal-footer">
														<button class="btn btn-secondary" type="button" name="borrar" id="borrar">Borrar</button>
														<button type="button" class="btn btn-primary" data-dismiss="modal" id="cerra-modal">Listo</button>
													</div>
												</div>
											</div>
										</div>

										<!-- MODAL REGISTRO NO ENTREGADO -->
										<div class="modal fade" id="modal_no_entregado" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
											<div class="modal-dialog modal-md2 modal-dialog-centered" role="document">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="modalLabel_codigo_qr">Registrar como no entregado</h5>
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
													</div>
													<form id="form_no_entrega" class="text-left" enctype="multipart/form-data">
													<div class="modal-body">
															<h3>Motivo</h3>
															<hr>
															<div class="col-md-12 col-sm-12 mt-3">
																<div class="custom-control custom-radio">
																	<input type="radio" id="motivo1" name="motivo" class="custom-control-input" value="No se encuentra el titular" checked>
																	<label class="custom-control-label" for="motivo1">No se encuentra el titular</label>
																</div>
																<div class="custom-control custom-radio">
																	<input type="radio" id="motivo2" name="motivo" class="custom-control-input" value="Direcciónincorrecta">
																	<label class="custom-control-label" for="motivo2">Direcciónincorrecta</label>
																</div>
																<div class="custom-control custom-radio">
																	<input type="radio" id="motivo3" name="motivo" class="custom-control-input" value="0">
																	<label class="custom-control-label" for="motivo3">Otro</label>
																</div>
															</div>
															<div class="form-group col-md-12 col-sm-12 mt-3">
																<input disabled class="form-control input-sm" id="otro_motivo" name="otro_motivo" type="text" autocomplete="off" placeholder="Añadir otro motivo">
															</div>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
															<button type="submit" class="btn btn-success">Registrar</button>
														</div>
													</form>
												</div>
											</div>
										</div>

										<!-- MODAL GUARDAR UBICACION -->
										<div class="modal fade" id="modal_ubicacion" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
											<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="modal_label_ubicacion">Ubicacion Actual</h5>
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
													</div>
													<div class="modal-body">
														<div id="map" class="col-md-12 col-sm-12" style="height: 500px;"></div>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
														<button type="button" class="btn btn-success" data-dismiss="modal" id="registrar_ubi">Guardar</button>
													</div>
												</div>
											</div>
										</div>

									</div>






            </div><!-- End Container fluid  -->
        </div><!-- End Page wrapper  -->
       <!-- <?phpinclude 'footer.php'; ?> -->
    </div><!-- End Wrapper -->
		<script type="text/javascript">
		$(document).ready( function () {
			//verificar login
			if (localStorage.getItem("id_usuario")) {
				console.log('esta logueado');
				//location.replace("inicio.html");
			}else {
				console.log('NO esta logueado');
				location.replace("login.html");
			}

			//definir tipo de usuario
			if (localStorage.getItem("tipo_usuario")=='superadmin') {
				tipo_usuario = 'superadmin';
			}else if (localStorage.getItem("tipo_usuario")=='admin') {
				tipo_usuario = 'admin';
			}else if (localStorage.getItem("tipo_usuario")=='proveedor') {
				tipo_usuario = 'proveedor';
			}else if (localStorage.getItem("tipo_usuario")=='cliente') {
				tipo_usuario = 'cliente';
			}else if (localStorage.getItem("tipo_usuario")=='encargado') {
				tipo_usuario = 'encargado';
			}
			else {
				tipo_usuario = 'visitante';
			};


			//ajax para el leftbar
			$.ajax({
				dataType: 'html',
				async: true,
				type: 'POST',
				url: 'inc/leftbar-data.php',
				cache: false,
				data: {q: tipo_usuario},
				success: function (data, status, xhr) {
					var n = data.toLowerCase().indexOf("error");
					if (n == -1) {
						$('#sidebarnav').html(data);
						cargarScriptMenu();
					}else{
						alertDismissJS(data, "error");
					}
				},
				error: function (jqXhr) {
					alertDismissJS($(jqXhr.responseText).text().trim(), "error");
				}
			});
		});
		$('#nombre_usuario').html(localStorage.getItem("nombre_usuario"));

		function cargarScriptMenu() {
			let scriptActual = document.getElementById('script');
			let nuevoScript = document.createElement('script');
			nuevoScript.src = 'dist/js/sidebarmenu.js?v=2';

			document.head.replaceChild(nuevoScript, scriptActual);
		}


		function logout(){
				localStorage.clear();
				sessionStorage.clear();
				location.replace('login.html');
		}
				$(document).ready(function() {
					$('#id_pedido').val(get('id_pedido'));
					$('#nombre_apellido').val(get('nombre'));
					if ($('#nombre_apellido').val()) {
						console.log('saltear 2do pin');
						var saltear='si';
					}else {
						console.log('solicitar pin');
					}


					$.ajax({
						dataType: 'json', async: true, cache: false, url: 'inc/pedidos-data.php', timeout:10000, type: 'POST', data: {q:'buscar_pedido', id_pedido: $("#id_pedido").val()},
						beforeSend: function(){
						},
						success: function (json){
							console.log(json[0].nombre);
							$("#nombre_apellido").html(json[0].nombre);
							$("#ruc").html(json[0].ruc);
							$("#direccion").html(json[0].direccion);
							$("#nro_casa").html(json[0].nro_casa);
							$("#zona").html(json[0].zona);
							$("#correo").html(json[0].correo);
							$("#entidad").html(json[0].entidad);
							if (json[0].estado=='ENTREGADO') {
								alertDismissJS('ESTE PEDIDO YA FUE ENTREGADO', "error");
								window.location.replace('lista.html');
							}else {
								console.log('ASDASDASD');
							}
						},
						error: function (jqXhr) {
							$("#spin_ruc").hide();
							alertDismissJS($(jqXhr.responseText).text().trim(), "error");
						}
					});

						// var signatureDiv = $("#signature").jSignature();
						// $("#guardar").click(function(){
						 $("#btn_foto_omitir").click(function(){
							 if (saltear='si') {
								 $('#carrusel').carousel('next');
								 $('#carrusel').carousel('next');
								 console.log('deberia saltear');

							 }else {
							 	console.log('no se pudo saltear');
							 }
						 });
						 $("#btn_foto").click(function(){
							 if (saltear='si') {
								 $('#carrusel').carousel('next');
								 $('#carrusel').carousel('next');
							 }
						 });


						$("#formulario").submit(function(e){
									e.preventDefault();

														//subir firma y actualizar datos de pedido
														var formData = new FormData(this);
														formData.append('razon_social', $("#nombre_apellido").html());
														formData.append('ruc', $("#ruc").html());
														formData.append('direccion', $("#direccion").html());
														formData.append('nro_casa', $("#nro_casa").html());
														formData.append('zona', $("#zona").html());
														formData.append('correo', $("#correo").html());
														formData.append('ubicacion', ubicacion);
														formData.append('saltear', 'saltear');
														$.ajax({
															dataType: 'html',
															type: 'POST',
															url: 'inc/pedidos-data.php',
															cache: false,
															processData: false,
                							contentType: false,

															data: formData,
															async: true,
															beforeSend: function(){
																NProgress.start();
																// $("#mensaje_facturas").html("<img src='images/progress_bar.gif'>");
															},
															success: function (data, status, xhr) {
																// $("#mensaje_facturas").html(data.mensaje);
																var n = data.toLowerCase().indexOf("error");
																NProgress.done();
																if (n == -1) {
																	alertDismissJS(data, "ok");
																	$('#carrusel').carousel('next');
																	$('.carrusel-next').prop('disabled', true);
																	$('#btn_no_entrega').prop('disabled', true);
																	console.log('exito');

																	window.location.replace('lista.html');

																} else {
																	alertDismissJS(data, "error");
																}
															},
															error: function (xhr) {
																//$("#mensaje").html(alertDismissJS("No se pudo completar la operación: " + xhr.status + " " + xhr.statusText, 'error'));
																console.log('NO');

															}
														});

														// }
				     });

					$("#borrar").click(function(){
				   		// signatureDiv.jSignature('reset');
						$("#signature").jSignature('reset');
					});



					$("#foto_cedula").change(function(){
						var fileLength = this.files.length;
						var match= ["image/jpeg","image/png","image/jpg","image/gif"];
						var vf = false;

						if (fileLength > 5) {
							alert('Solo puede elegir 5 fotos.');
							$("#foto_cedula").val('');
							$('#prev_foto_cedula0').attr('src', '');
							$('#prev_foto_cedula1').attr('src', '');
							$('#prev_foto_cedula2').attr('src', '');
							$('#prev_foto_cedula3').attr('src', '');
							$('#prev_foto_cedula4').attr('src', '');
						}

						for(let i = 0; i < fileLength; i++){
							var file = this.files[i];
							var imagefile = file.type;
							if(!((imagefile==match[0]) || (imagefile==match[1]) || (imagefile==match[2]) || (imagefile==match[3]))){
								alert('Please select a valid image file (JPEG/JPG/PNG/GIF).');
								$("#foto_cedula").val('');
								$('#prev_foto_cedula0').attr('src', '');
								$('#prev_foto_cedula1').attr('src', '');
								$('#prev_foto_cedula2').attr('src', '');
								$('#prev_foto_cedula3').attr('src', '');
								$('#prev_foto_cedula4').attr('src', '');
							} else {
								vf = true;
							}
						}

						var selectedfile = this.files;
						if (vf) {
							console.log(selectedfile);

							for(let i = 0; i < 5; i++){

								var imageFile = selectedfile[i];
								var fileReader = new FileReader();
								fileReader.onload = function(fileLoadedEvent) {
									var srcData = fileLoadedEvent.target.result;
									$('#prev_foto_cedula'+i+'').attr('src', srcData);
									$('#btn_foto').prop('disabled', false);
								}
								fileReader.readAsDataURL(imageFile);


							}


						}
					});


					// Inicia el carrusel
					$('#carrusel').carousel({
						interval: false,
						keyboard: false
					});


					// avanza el carrusel
					$('.carrusel-next').click(function() {
						// $('.carrusel-next').prop('disabled', true);

						// avanza
						$('#carrusel').carousel('next');
					});

					// retrocede el carrusel
					$('.carrusel-prev').click(function() {
						// retrocede
						$('#carrusel').carousel('prev');
						$('.carrusel-next').prop('disabled', false);
					});

					// valida pin en 6 digitos
					$('#pin').on('keyup change', function() {
						var pin_length = $('#pin').val().length;
						if (pin_length == 6) {
							//$('#verificar_pin').prop('disabled', false);
						} else {
							//$('#verificar_pin').prop('disabled', true);
						}
					});

					// avanza el carrusel
					// $('#verificar_pin').click(function() {
					// 	$.ajax({
					// 		dataType: 'html',
					// 		type: 'POST',
					// 		url: 'inc/pedidos-data.php',
					// 		cache: false,
					// 		data: {q: 'verificar_pin', id_pedido:$("#id_pedido").val(), pin:$('#pin').val() },
					// 		async: true,
					// 		beforeSend: function(){
					// 			NProgress.start();
					// 			// $("#mensaje_facturas").html("<img src='images/progress_bar.gif'>");
					// 		},
					// 		success: function (data, status, xhr) {
					// 			var n = data.toLowerCase().indexOf("error");
					// 			NProgress.done();
					// 			if (n == -1) {
					// 				alertDismissJS(data, "ok");
					//
					// 				// // avanza
					// 				$('#carrusel').carousel('next');
					// 			} else {
					// 				alertDismissJS(data, "error");
					// 			}
					// 		},
					// 		error: function (xhr) {
					// 			$("#mensaje").html(alertDismissJS("No se pudo completar la operación: " + xhr.status + " " + xhr.statusText, 'error'));
					//
					// 		}
					// 	});
					// });

					// muestra modal de firma
					$('#btn_modal_firma').click(function() {
						$('#modal_firma').modal('show');
					});

					// añade jSignature
					$('#modal_firma').on('show.bs.modal', function (e) {
						$("#signature").jSignature();
						$("#signature").resize();
					});

					// cierra modal y genera codigo de imagen de la firma
					$('#cerra-modal').click(function() {
						$('#carrusel').carousel(3);

						var datapair = $("#signature").jSignature("getData", "svgbase64");
						var imagen = new Image();
						imagen.src = "data:" + datapair[0] + "," + datapair[1];
						$("#firma").val(imagen.src);
						console.log($("#firma").val());

						// codigo que se genera si la firma queda en blanco
						if ($("#firma").val() == "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMCIgaGVpZ2h0PSIwIj48L3N2Zz4=") {
							$('.carrusel-next').prop('disabled', true);
							$('#guardar').prop('disabled', true);
						} else {
							$('#prev_firma').attr('src', $("#firma").val());
							$('.carrusel-next').prop('disabled', false);
							$('#guardar').prop('disabled', false);
						}
					});



		    	});

				/**
				* Obtiene informacion pasada por get
				*
				* Funciona igual que $_GET de php
				* @param String name
				* @return String
				*/
				function get(name) {
					name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
					var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
					results = regex.exec(location.search);
					return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
				}

				// MODAL NO ENTREGA
				$('#btn_no_entrega').click(function() {
					$('#modal_no_entregado').modal('show');
				});

				// HABILITA CAMPO PARA AÑADIR OTRO MOTIVO
				$('input[name="motivo"]').change(function() {
					if ($('input[name="motivo"]:checked').val() == 0) {
						$('#otro_motivo').prop('required', true);
						$('#otro_motivo').prop('disabled', false);
					} else {
						$('#otro_motivo').prop('required', false);
						$('#otro_motivo').prop('disabled', true);
					}
				});

				// REGISTRAR NO ENTREGADO
				$('#form_no_entrega').submit(function(e){
					e.preventDefault();
					var motivo = "";

					if ($('input[name="motivo"]:checked').val() == 0) {
						motivo = $('#otro_motivo').val();
					} else {
						motivo = $('input[name="motivo"]:checked').val();
					}

					$.ajax({
						dataType: 'html',
						type: 'POST',
						url: 'inc/pedidos-data.php',
						cache: false,
						data: {q: 'registrar_no_entregado', motivo: motivo, id_pedido:$("#id_pedido").val(), ubicacion: ubicacion, ruc: get('ruc'), razon_social: get("nombre"), direccion:get("direccion"), zona:get("zona"), correo:get("correo") },
						async: true,
						beforeSend: function(){
							// $("#mensaje_facturas").html("<img src='images/progress_bar.gif'>");
						},
						success: function (data, status, xhr) {
							// $("#mensaje_facturas").html(data.mensaje);
							var n = data.toLowerCase().indexOf("error");
							if (n == -1) {
								$('.carrusel-next').prop('disabled', true);
								$('#btn_no_entrega').prop('disabled', true);
								$('#modal_no_entregado').modal('hide');
								alertDismissJS(data, "ok");
								console.log('exito');
							} else {
								alertDismissJS(data, "error");
							}
						},
						error: function (xhr) {
							alertDismissJS("No se pudo completar la operación: " + xhr.status + " " + xhr.statusText, 'error');
						}
					});
				});

				// Acceso global
				var ubicacion;

				// DEBE IR EN CADA HTML PARA RASTREAR AL REPARTIDOR

				// UBICACION DEL REPARTIDOR
				function geo_success(position) {
					// coordenadas de la ubicacion
					ubicacion = position.coords.latitude + ',' + position.coords.longitude;

					$.ajax({
						dataType: 'html',
						async: true,
						type: 'POST',
						url: 'inc/repartidores-data.php',
						cache: false,
						// id_repartidor se debe obtener del proveedor logueado
						data: {q: 'guardar_ubicacion',ubicacion: ubicacion , id_repartidor: localStorage.getItem("id_repartidor") },
						success: function (data, status, xhr) {
							var n = data.toLowerCase().indexOf("error");
							if (n == -1) {
								// console.log("ubicacion enviada al servidor : " + ubicacion);
							}else{
								alertDismissJS(data, "error");
							}
						},
						error: function (jqXhr) {
							alertDismissJS($(jqXhr.responseText).text().trim(), "error");
						}
					});
				}

				function geo_error(error) {
					switch(error.code) {
						case error.PERMISSION_DENIED:
							alertDismissJS("Solicitud de geolocalización denegada, no se podra rastrear su ubicación", "error");
						break;

						case error.POSITION_UNAVAILABLE:
							alertDismissJS("La información de ubicación no está disponible", "error");
						break;

						case error.TIMEOUT:
							alertDismissJS("Tiempo de espera agotado. No se pudo obtener su ubicacion", "error");
						break;

						case error.UNKNOWN_ERROR:
							alertDismissJS("Error no identificado", "error");
						break;
					}
				}

				if (navigator.geolocation) {
					// se ejecuta cada vez que la ubicacion del proveedor cambie
					if (localStorage.getItem("tipo_usuario")=='proveedor'){
						var wpid = navigator.geolocation.watchPosition(geo_success, geo_error);
					}
				} else {
					alertDismissJS("La geolocalización no es compatible con este navegador", "error");
				}

				// FIN UBICACION DEL REPARTIDOR


		</script>
</body>
</html>
